steps:
  STG_PAYMENT_COMBINED-cb6c4838-0344-4d76-8e79-cb9520b893be:
    operation:
      config:
        insertStrategy: INSERT
        postSQL: ""
        preSQL: ""
        testsEnabled: true
        truncateBefore: true
      database: ""
      deployEnabled: true
      description: Staging of payment combined with field changes to allign with charge table. Also bringing in the applicable invoice
      isMultisource: false
      locationName: TOWER_COMBINED
      materializationType: table
      metadata:
        appliedNodeTests: []
        columns:
          - columnReference:
              columnCounter: 416ce0d1-5fa3-4833-88e3-c00049ed7667
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Payment UID
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: fc6277a1-74e9-4001-8115-d9348746151f
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 3d5e9db8-e10c-4dc8-b342-9bfaa14428c7
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Source UID
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 0b152953-78ab-45b2-a726-c93f2e930b1e
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 26bf87b2-7ee5-4757-a61a-cfec80cfaab7
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: TIMESTAMP_NTZ(9)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Payment Date
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: d679765e-f5a7-45c8-862a-c14b83092af3
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 30b86f8b-f3aa-4465-94b3-091dba0ea770
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Status
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: c486b200-d693-479b-b3f8-fd4c57d1b159
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: c94fd37c-dcd0-4eff-9dec-15ce59852fac
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: TIMESTAMP_NTZ(9)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Clearing Date
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 4699f6e6-681d-4ae1-bf8b-2d60ce1e6692
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 50ef7540-df66-4c8d-92e6-e348c93ec3f8
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Customer Number
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: ebe27c2b-fd75-490b-b5cc-0eaadb457299
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: e0aac030-30af-487c-b772-cbdcb7cbc53c
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Payment Method
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 3e93dd24-3e36-46e9-8835-3cb620c0d2e2
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: f4a2c780-290b-4cc4-9227-d3463050d6ab
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Credit Card Type
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: a1453eb0-d2dc-4c96-9e44-05fc38900421
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: a0cc5322-991f-405c-9274-d0af6974d28d
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Bank Account
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: ff14e60e-1de0-4461-9387-745a3949507b
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 3f4ccd3f-30b4-4ec6-ae10-032e402ba2be
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Payment Number
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 67ab0e6d-377c-439b-bf81-3a8e0e2a7966
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 90e61988-bb87-4fc8-ab71-074c5b1ab28b
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Amount
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: a5f4c4fb-beaa-4bcb-9764-2938eb582ea6
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 1fcc93ff-1115-422d-a587-f6ab31e85063
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Remove Credit Hold
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: e4a7924c-97a5-4b13-9acb-5069d48b2f70
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: ab8b78e4-4acd-4e89-a370-86cf2f80251c
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Credit Amount
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: f8e23e5f-97e3-4fba-ba7d-d766f30500fd
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 5f414005-f17c-498a-ae2f-d3fb4909ba65
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Credit Reason
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 13f859fb-0d42-4491-9ec5-e625a9938681
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 70fe5097-9628-4887-bcd4-8bc11a321015
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Note
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 3e72302c-806a-4c98-a09f-a3a67fb6d4d1
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: e9e4c9c8-5b36-4633-bcae-6acb74796f24
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Bank Account Ref ID
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 61fbb238-3814-4119-b2ff-fe29da2736c3
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: e11f070d-f1ee-41cc-87c6-8622653990b0
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: NUMBER(38,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Collections Notified?
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 03af1802-a0e3-423b-9a19-953bbeeb8c2d
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: 0282323f-6b7d-40bf-8125-bce220f4c98d
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Customer Payment Account Unique ID
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 83e2382d-71ce-43b2-b2e4-c45669f2262e
                    stepCounter: cb34bb59-0419-4c1b-b3db-0d491487d533
                transform: ""
          - columnReference:
              columnCounter: ea65af50-df27-4167-9f7c-5db88cbda451
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            dataType: VARCHAR
            description: ""
            hashColumns: []
            hashDetails: null
            name: Source
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 9dbd060f-29a4-4442-a6ad-c66763f6c05c
                    stepCounter: dad57b1e-b8d9-4227-9d92-4f169f6ce074
                transform: "'TOWER_'||\"ARDETAIL_COMBINED\".\"COMPANYID\""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 91736be3-6c31-4d67-8b82-21c86f2eacde
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            config: {}
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            keyColumnType: None
            name: Type
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: "'Payment'"
            systemColumnType: None
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 10a63456-37fc-455c-bddf-807aa928773d
              stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
            config: {}
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            keyColumnType: None
            name: Link to Invoice
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: aabe0418-4d7f-4979-9f0b-20192ca175be
                    stepCounter: dad57b1e-b8d9-4227-9d92-4f169f6ce074
                transform: CASE WHEN "ARDETAIL_COMBINED"."INVOICEUID" IS NULL THEN "STG_LAST_INVOICE_CUSTOMER_TOWER"."Invoice UID" ELSE "ARDETAIL_COMBINED"."INVOICEUID" END
            systemColumnType: None
            transform: ""
        cteString: ""
        enabledColumnTestIDs: []
        sourceMapping:
          - aliases:
              ARDETAIL_COMBINED: cd62b4e3-06b4-4cba-8f88-bcf5a192026c
              PAYMENT_COMBINED: cb34bb59-0419-4c1b-b3db-0d491487d533
              STG_LAST_INVOICE_CUSTOMER_TOWER: 4536f375-af92-48b1-97f3-f52df520daa2
            customSQL:
              customSQL: ""
            dependencies:
              - locationName: TOWER_COMBINED
                nodeName: ARDETAIL_COMBINED
              - locationName: TOWER_COMBINED
                nodeName: PAYMENT_COMBINED
              - locationName: TOWER_COMBINED
                nodeName: STG_LAST_INVOICE_CUSTOMER_TOWER
            join:
              joinCondition: |-
                FROM {{ ref('TOWER_COMBINED', 'PAYMENT_COMBINED') }} "PAYMENT_COMBINED"
                LEFT JOIN {{ ref('TOWER_COMBINED', 'ARDETAIL_COMBINED') }} "ARDETAIL_COMBINED"
                ON "PAYMENT_COMBINED"."PAYMENTUID" = "ARDETAIL_COMBINED"."SOURCEUID"
                LEFT JOIN {{ ref('TOWER_COMBINED', 'STG_LAST_INVOICE_CUSTOMER_TOWER') }} "STG_LAST_INVOICE_CUSTOMER_TOWER"
                ON "PAYMENT_COMBINED"."CUSTID" = "STG_LAST_INVOICE_CUSTOMER_TOWER"."Customer Number"
            name: STG_PAYMENT_COMBINED
            noLinkRefs: []
      name: STG_PAYMENT_COMBINED
      overrideSQL: false
      schema: ""
      sqlType: Stage
      type: sql
    stepCounter: cb6c4838-0344-4d76-8e79-cb9520b893be
