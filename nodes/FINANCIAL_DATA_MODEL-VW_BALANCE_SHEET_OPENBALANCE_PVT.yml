steps:
  VW_BALANCE_SHEET_OPENBALANCE_PVT-35279c8a-5c83-41da-99e6-e22ed2ca166a:
    operation:
      config:
        insertStrategy: UNION
        selectDistinct: false
      database: ""
      deployEnabled: true
      description: ""
      isMultisource: false
      locationName: FINANCIAL_DATA_MODEL
      materializationType: view
      metadata:
        appliedNodeTests: []
        columns:
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 05354c53-0361-42f9-8113-1c2bb807f362
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(6)
            defaultValue: ""
            description: ""
            name: Database ID
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 99c6261b-c475-4a80-bf22-1f8e7051a509
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(45)
            defaultValue: ""
            description: ""
            name: Account Number
            nullable: false
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 5f2924c1-3331-414c-99fa-6cc1507d5f22
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(4)
            defaultValue: ""
            description: ""
            name: Fiscal Year
            nullable: false
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: f5557d0e-25a1-448d-9bd7-a4122d4ffe14
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(6)
            defaultValue: ""
            description: ""
            name: AUDTORG
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - columnReference:
              columnCounter: 35fcbb9a-c651-4d86-a629-843b3edbeb6f
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            dataType: VARCHAR(16777216)
            description: ""
            hashColumns: []
            hashDetails: null
            name: SOURCE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: ebc12d8a-6b53-4a2c-b818-d3eb89def2d4
                    stepCounter: 60575ce5-d395-4889-95fc-dd8963ddd1d6
                transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 258a02c2-4d0d-40b8-9684-910e0126d7c6
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(16777216)
            defaultValue: ""
            description: ""
            name: Fiscal Period
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 9b0f3a3a-259d-4b75-9095-736383dda385
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: VARCHAR(16777216)
            defaultValue: ""
            description: ""
            name: Fiscal Month
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 5efdbc5b-5132-4c21-90b7-54e7cb26c4d3
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: DATE
            defaultValue: ""
            description: ""
            name: DATE
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: e30fc926-469b-4612-a10f-de146a91fd80
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: DATE
            defaultValue: ""
            description: ""
            name: PERIODENDDATE
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 142ca2dc-5645-4e55-82cc-70bb29a9943e
              stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
            config: {}
            dataType: NUMBER(19,3)
            defaultValue: ""
            description: ""
            name: PERIODBALANCE
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: ""
            transform: ""
        cteString: ""
        enabledColumnTestIDs: []
        sourceMapping:
          - customSQL:
              customSQL: |-
                {{ stage('Override Create SQL') }}
                	CREATE OR REPLACE VIEW {{ ref('FINANCIAL_DATA_MODEL', 'VW_BALANCE_SHEET_OPENBALANCE_PVT')}} AS 
                    (
                SELECT 
                LTRIM(RTRIM(AUDTORG)) AS "Database ID",
                LTRIM(RTRIM(ACCTID)) AS "Account Number",
                FSCSYR as "Fiscal Year",
                AUDTORG,
                SOURCE,
                --CONCAT(ACCTID, CONCAT(' - ', ACCTDESC)) AS "Account Name",
                CASE "Fiscal Month"
                    WHEN 'OPENBAL' THEN 'OPENBALANCE'
                ELSE NULL
                END AS "Fiscal Period",
                CASE "Fiscal Month"
                    WHEN 'OPENBAL' THEN 'OPENBALANCE'
                ELSE NULL
                END AS "Fiscal Month",
                CAST(
                CASE 
                WHEN "Fiscal Period" = 'OPENBALANCE' THEN CONCAT("Fiscal Year", '-','01', '-','01')
                WHEN "Fiscal Period" NOT IN ( 13, 14) THEN CONCAT("Fiscal Year", '-',"Fiscal Period", '-','01')
                    ELSE NULL END AS DATE) AS DATE,
                LAST_DAY(DATE) AS PERIODENDDATE,
                PERIODBALANCE
                FROM 
                 {{ ref('SAGE_COMBINED', 'GLAFS_COMBINED') }} GLAF
                    -- INNER JOIN "SAGE_COMBINED"."GLAMF_COMBINED" GLAMF
                   -- ON GLAF.ACCTID = GLAMF.ACCTID AND GLAF.SOURCE = GLAMF.SOURCE
                    UNPIVOT (PERIODBALANCE FOR "Fiscal Month" IN (
                OPENBAL
                ))
                WHERE FSCSYR >=2022
                ORDER BY "Fiscal Period" asc)
                    
            dependencies:
              - locationName: SAGE_COMBINED
                nodeName: GLAFS_COMBINED
            join:
              joinCondition: FROM {{ ref('SAGE_COMBINED', 'GLAFS_COMBINED') }} "GLAFS_COMBINED"
            name: VW_BALANCE_SHEET_OPENBALANCE_PVT
            noLinkRefs: []
      name: VW_BALANCE_SHEET_OPENBALANCE_PVT
      overrideSQL: true
      schema: ""
      sqlType: View
      type: sql
    stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
