fileVersion: 1
id: 35279c8a-5c83-41da-99e6-e22ed2ca166a
name: VW_BALANCE_SHEET_OPENBALANCE_PVT
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: FINANCIAL_DATA_MODEL
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 1a1de5be-8c87-4f22-9c77-a3a25061a6b0
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(108)
        defaultValue: ""
        description: ""
        name: Account Name
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: a1f56378-4945-46b4-80d0-f64fc4c56358
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(12)
        defaultValue: ""
        description: ""
        name: Account Group Code
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 9d0e5fc4-8d63-43d3-90d7-456735e6be19
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: ""
        name: Account Group Description
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 69869c22-50e6-4740-8bf3-d7ec921c6822
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: ""
        name: CONAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 2e6bde71-2a67-4cd8-8d70-8e2a574f9a9f
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(60)
        defaultValue: ""
        description: ""
        name: Legal Name
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 1043588b-60a6-41d0-b202-7cb14272e7df
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(15)
        defaultValue: ""
        description: ""
        name: ACCT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 05354c53-0361-42f9-8113-1c2bb807f362
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(6)
        defaultValue: ""
        description: ""
        name: Database ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 99c6261b-c475-4a80-bf22-1f8e7051a509
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(45)
        defaultValue: ""
        description: ""
        name: Account Number
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 5f2924c1-3331-414c-99fa-6cc1507d5f22
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(4)
        defaultValue: ""
        description: ""
        name: Fiscal Year
        nullable: false
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 35fcbb9a-c651-4d86-a629-843b3edbeb6f
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: SOURCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ebc12d8a-6b53-4a2c-b818-d3eb89def2d4
                stepCounter: 60575ce5-d395-4889-95fc-dd8963ddd1d6
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 258a02c2-4d0d-40b8-9684-910e0126d7c6
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: Fiscal Period
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 9b0f3a3a-259d-4b75-9095-736383dda385
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: VARCHAR(16777216)
        defaultValue: ""
        description: ""
        name: Fiscal Month
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 5efdbc5b-5132-4c21-90b7-54e7cb26c4d3
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: e30fc926-469b-4612-a10f-de146a91fd80
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        name: PERIODENDDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 48d3191a-814e-402e-aae1-73c42670f81d
          stepCounter: 35279c8a-5c83-41da-99e6-e22ed2ca166a
        config: {}
        dataType: NUMBER(19,3)
        defaultValue: ""
        description: ""
        name: Journal Transaction Amount
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
        transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('Override Create SQL') }}
            	CREATE OR REPLACE VIEW {{ ref('FINANCIAL_DATA_MODEL', 'VW_BALANCE_SHEET_OPENBALANCE_PVT')}} AS (
                with Bal as
                (
            SELECT distinct
            LTRIM(RTRIM(AUDTORG)) AS "Database ID",
            LTRIM(RTRIM(ACCTID)) AS "Account Number",
            FSCSYR as "Fiscal Year",
            SOURCE,
            CASE "Fiscal Month"
                WHEN 'OPENBAL' THEN 'OPENBALANCE'
            ELSE NULL
            END AS "Fiscal Period",
            CASE "Fiscal Month"
                WHEN 'OPENBAL' THEN 'OPENBALANCE'
            ELSE NULL
            END AS "Fiscal Month",
            CAST(
            CASE 
            WHEN "Fiscal Period" = 'OPENBALANCE' THEN CONCAT("Fiscal Year", '-','01', '-','01')
            WHEN "Fiscal Period" NOT IN ( 13, 14) THEN CONCAT("Fiscal Year", '-',"Fiscal Period", '-','01')
                ELSE NULL END AS DATE) AS DATE,
            LAST_DAY(DATE) AS PERIODENDDATE,
            "Journal Transaction Amount"
            FROM 
             {{ ref('SAGE_COMBINED', 'GLAFS_COMBINED') }} GLAF
                UNPIVOT ("Journal Transaction Amount" FOR "Fiscal Month" IN (
            OPENBAL
            ))
            WHERE FSCSYR >=2022
            ORDER BY "Fiscal Period" asc)--CTE

            select DISTINCT  CONCAT(LTRIM(RTRIM(ACCTID)), CONCAT(' - ', ACCTDESC)) AS "Account Name", LTRIM(RTRIM(GLACGRP.ACCTGRPCOD)) AS "Account Group Code" ,
            TRIM(GLACGRP.ACCTGRPDES) AS "Account Group Description" , CSCOM.CONAME, CSCOM.LEGALNAME AS "Legal Name", GLAMF.ACCTSEGVAL AS ACCT, GLAFS.* 
            from Bal GLAFS
               INNER JOIN {{ ref('SAGE_COMBINED', 'GLAMF_COMBINED') }} GLAMF
              ON GLAFS."Account Number" = LTRIM(RTRIM(GLAMF.ACCTID)) AND GLAFS."Database ID" = GLAMF.AUDTORG
                LEFT JOIN {{ ref('SAGE_COMBINED', 'GLACGRP_COMBINED') }} GLACGRP
              ON LTRIM(RTRIM(GLAMF.ACCTGRPCOD)) = LTRIM(RTRIM(GLACGRP.ACCTGRPCOD)) AND GLACGRP.AUDTORG = GLAMF.AUDTORG
                  LEFT JOIN {{ ref('SAGE_COMBINED', 'CSCOM_COMBINED') }} CSCOM
              ON LTRIM(RTRIM(CSCOM.AUDTORG)) = LTRIM(RTRIM(GLAFS."Database ID"))
            where GLAMF."Sort" =1 
                AND GLAMF."_FIVETRAN_DELETED"=FALSE 
                AND GLAMF."METADATA$ACTION" ='INSERT'
                )
        dependencies:
          - locationName: SAGE_COMBINED
            nodeName: GLAFS_COMBINED
        join:
          joinCondition: FROM {{ ref('SAGE_COMBINED', 'GLAFS_COMBINED') }} "GLAFS_COMBINED"
        name: VW_BALANCE_SHEET_OPENBALANCE_PVT
        noLinkRefs: []
  name: VW_BALANCE_SHEET_OPENBALANCE_PVT
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
