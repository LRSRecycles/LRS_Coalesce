steps:
  AR_INVOICE_AMOUNTS-6cbdcc75-9616-48ec-95e9-b79240d9b295:
    operation:
      config:
        insertStrategy: INSERT
        postSQL: ""
        preSQL: ""
        testsEnabled: true
        truncateBefore: true
      database: ""
      deployEnabled: true
      description: ""
      isMultisource: true
      locationName: FINANCIAL_DATA_MODEL
      materializationType: view
      metadata:
        appliedNodeTests: []
        columns:
          - columnReference:
              columnCounter: 3c5e210c-c1a6-409a-a4a9-74f4a104ccc4
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: VARCHAR
            description: ""
            hashColumns: []
            hashDetails: null
            isBusinessKey: true
            name: Invoice UID
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: e5423fef-7aee-4bf3-9b57-2e7e806b9a22
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 3d3eb32a-8d77-4978-8f65-c4719fcd8022
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: f799cde5-2702-492d-be83-b43e55baefd9
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: VARCHAR
            description: ""
            hashColumns: []
            hashDetails: null
            isBusinessKey: true
            name: Customer Number
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 09351083-f732-4f8a-801a-a2bc4f64bda7
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 62237e4b-5ec1-4b1a-ae88-9a7ec2cec2ec
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: 5379cca1-7f0b-4e64-bbd8-c71aec741730
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: VARCHAR
            description: ""
            hashColumns: []
            hashDetails: null
            isBusinessKey: true
            name: Site Number
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 7b326805-baf1-47c8-9ed1-58caf894f91d
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 9d2407a2-d40d-40aa-a36a-9de8401cf0f8
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: 581c44d4-daea-4fc9-a443-158eec519821
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: VARCHAR(13)
            description: ""
            hashColumns: []
            hashDetails: null
            isBusinessKey: true
            name: Invoice Number
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: f78d0f7c-d4e1-474e-bff4-a887072d5695
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: ad251460-54b0-4b2c-a4a8-2ed433f20390
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: e6f56b2b-1b54-43c6-98e4-586d31c8653d
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: TIMESTAMP_NTZ(9)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Invoice Date
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: d2971ee2-7bad-4ec7-aa04-519131f4de3f
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 805cb634-6fcb-45ba-8537-755e1c5b7228
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: 5a271921-8496-4417-9c96-77c87aa5e397
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: NUMBER(18,2)
            description: ""
            hashColumns: []
            hashDetails: null
            name: Amount
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 3b7bb00d-8441-4567-bcd9-6aa73adb48dd
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 01a9f20d-aa72-4469-b69d-71ca043cd928
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - columnReference:
              columnCounter: e4337c49-1766-460d-ad3f-94fbcba823cc
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            hashColumns: []
            hashDetails: null
            isBusinessKey: true
            name: Source
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 7ceee4ba-fa87-4c5e-a8c0-fbad648ced91
                    stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
                transform: ""
              - columnReferences:
                  - columnCounter: 8a761f68-1b4a-4667-bfb4-df73c01afd8f
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: c6879ef4-beac-426d-aa95-ec4058ddb673
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            config: {}
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            isBusinessKey: true
            keyColumnType: None
            name: Source_Customer
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: "\"DM01_COMBINED\".\"SOURCE\"||'-'||\"DM01_COMBINED\".\"DM01_CUST\""
              - columnReferences: []
                transform: "\"STG_INVOICE_COMBINED\".\"Source\"||'-'||\"STG_INVOICE_COMBINED\".\"Customer Number\""
            systemColumnType: None
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 9201fbce-c10b-4c18-9853-a9b4bba17628
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            config: {}
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            keyColumnType: None
            name: Source_Customer_Site
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: "\"DM01_COMBINED\".\"SOURCE\"||'-'||\"DM01_COMBINED\".\"DM01_CUST\"||'-'||\"DM01_COMBINED\".\"DM01_SITE\""
              - columnReferences: []
                transform: "\"STG_INVOICE_COMBINED\".\"Source\"||'-'||\"STG_INVOICE_COMBINED\".\"Customer Number\"||'-'||\"STG_INVOICE_COMBINED\".\"Site Number\""
            systemColumnType: None
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: bbaeae2b-c40f-4a97-be3d-688aaaf24606
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            config: {}
            dataType: VARCHAR
            defaultValue: ""
            description: ""
            isBusinessKey: true
            keyColumnType: None
            name: Source_Invoice_UID
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: "\"DM01_COMBINED\".\"SOURCE\"||'-'||\"DM01_COMBINED\".\"DM01_ID\""
              - columnReferences: []
                transform: "\"STG_INVOICE_COMBINED\".\"Source\"||'-'||\"STG_INVOICE_COMBINED\".\"Invoice UID\""
            systemColumnType: None
            transform: ""
          - acceptedValues:
              strictMatch: true
              values: []
            appliedColumnTests: {}
            columnReference:
              columnCounter: 6c02cb13-aac2-4697-8a30-eee9804bcb6b
              stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
            config: {}
            dataType: DATETIME
            defaultValue: ""
            description: Eventually will be Terms + invoice date where applicable in TRUX, correct in Tower
            keyColumnType: None
            name: Due Date
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: "0"
                    stepCounter: "0"
                transform: CASE WHEN "CUSTOMER_MASTER"."Customer Bill To" = 'Separate (A/R Site)' then DATEADD(DAY,"CUST_SITE_PREFERENCES"."Payment Terms","DM01_COMBINED"."DM01_DATE") WHEN "CUSTOMER_MASTER"."Customer Bill To" IN ('Separate (A/R Customer)','Consolidated') THEN dateadd(DAY,"CUSTOMER_PREFERENCES"."Payment Terms 2","DM01_COMBINED"."DM01_DATE") else "DM01_COMBINED"."DM01_DATE" END
              - columnReferences:
                  - columnCounter: 40667035-d9fe-4b6d-8297-34eb08255553
                    stepCounter: 926de0bb-edd5-4689-b171-81b4c6a87565
                transform: ""
            systemColumnType: None
            transform: ""
        enabledColumnTestIDs: []
        sourceMapping:
          - aliases:
              CUSTOMER_MASTER: becf5d54-6c39-4fc7-9462-7c72760dddd6
              CUSTOMER_PREFERENCES: 52e3dc99-9f19-4d86-a9b4-89bca60d3eef
              CUST_SITE_PREFERENCES: 828f44ad-9ea8-4f17-8021-698a7dd934d1
              DM01_COMBINED: 8e473efe-2de8-4255-bf7b-195f76a0318b
            customSQL:
              customSQL: ""
            dependencies:
              - locationName: MASTER_DATA_CLEAN
                nodeName: CUSTOMER_MASTER
              - locationName: TRUXCOMBINED_RAW
                nodeName: CUST_SITE_PREFERENCES
              - locationName: TRUXCOMBINED_RAW
                nodeName: CUSTOMER_PREFERENCES
              - locationName: TRUXCOMBINED_RAW
                nodeName: DM01_COMBINED
            join:
              joinCondition: |-
                FROM {{ ref('TRUXCOMBINED_RAW', 'DM01_COMBINED') }} "DM01_COMBINED"
                LEFT JOIN {{ ref('TRUXCOMBINED_RAW', 'CUST_SITE_PREFERENCES') }} "CUST_SITE_PREFERENCES"
                ON "DM01_COMBINED"."DM01_SITE" = "CUST_SITE_PREFERENCES"."Site" 
                and "DM01_COMBINED"."DM01_CUST" = "CUST_SITE_PREFERENCES"."Customer" 
                and "DM01_COMBINED"."SOURCE"="CUST_SITE_PREFERENCES"."SOURCE"
                LEFT JOIN {{ ref('TRUXCOMBINED_RAW', 'CUSTOMER_PREFERENCES') }} "CUSTOMER_PREFERENCES"
                ON "DM01_COMBINED"."DM01_CUST" = "CUSTOMER_PREFERENCES"."Customer" 
                and "DM01_COMBINED"."SOURCE" = "CUSTOMER_PREFERENCES"."SOURCE"
                LEFT JOIN {{ ref('MASTER_DATA_CLEAN', 'CUSTOMER_MASTER') }} "CUSTOMER_MASTER"
                ON "DM01_COMBINED"."DM01_CUST"= "CUSTOMER_MASTER"."Customer Number"
                AND "DM01_COMBINED"."SOURCE" = "CUSTOMER_MASTER"."Source"
                where "DM01_COMBINED"."Sort" =1 
                AND "DM01_COMBINED"."_FIVETRAN_DELETED"=FALSE 
                and "DM01_COMBINED"."METADATA$ACTION" ='INSERT'
            name: DM01_COMBINED_TRUX
            noLinkRefs: []
          - aliases:
              STG_INVOICE_COMBINED: 926de0bb-edd5-4689-b171-81b4c6a87565
            customSQL:
              customSQL: ""
            dependencies:
              - locationName: TOWER_COMBINED
                nodeName: STG_INVOICE_COMBINED
            join:
              joinCondition: FROM {{ ref('TOWER_COMBINED', 'STG_INVOICE_COMBINED') }} "STG_INVOICE_COMBINED"
            name: STG_INVOICE_COMBINED
            noLinkRefs: []
      name: AR_INVOICE_AMOUNTS
      overrideSQL: false
      schema: ""
      sqlType: Stage
      type: sql
    stepCounter: 6cbdcc75-9616-48ec-95e9-b79240d9b295
