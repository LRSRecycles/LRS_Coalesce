fileVersion: 1
id: 767ed12f-6933-4936-9ded-404fd1e341c4
name: STG_MUNI_REVENUE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: false
  description: ""
  isMultisource: false
  locationName: TRUXCOMBINED_RAW
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: dab7a985-d70b-4fc2-998b-6a30d8dcd66a
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Routing Customer
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 83aba3ad-4fff-4af6-832e-9b0c485ee936
                stepCounter: 9ddbbe16-6d4b-44e2-a5dc-3093ed0200f9
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 00df01f1-d026-4972-bbf1-5c35d6419538
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: Varchar
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Billing Customer
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc8b727a-650d-4328-bfbc-01a5878de7a6
                stepCounter: 5a5e9610-ebc0-47e5-9c3b-15332ff9a39f
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: e417651a-d3e9-4ed7-84f6-7c71579e1176
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: Varchar
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Billing Cycle
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ccdfaf98-04b3-4721-b84e-d37fa9df6f57
                stepCounter: 5a5e9610-ebc0-47e5-9c3b-15332ff9a39f
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: d35531b0-3792-4d04-9926-60ccb256224b
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: Timestamp_ntz(9)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Effective Date
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 956daedf-a94a-47da-99b5-54f4a41adf95
                stepCounter: eff228bf-ae85-4729-b262-adc8e690ab35
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 7a1db236-8a7e-47cc-832b-7026c84ffa9d
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: Timestamp_ntz(9)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Bill Up To Date
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 418088a1-f763-443c-908f-1abff1b0317c
                stepCounter: eff228bf-ae85-4729-b262-adc8e690ab35
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: ffb18016-708e-4619-8a28-644a335fa0c2
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: DM01_CUST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 09351083-f732-4f8a-801a-a2bc4f64bda7
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: e2dfaeb2-a597-4238-936a-771c8397ce75
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Invoice
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f78d0f7c-d4e1-474e-bff4-a887072d5695
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: eef24769-22f4-4998-8de0-4495c239324b
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: timestamp_ntz(9)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Invoice Date
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d2971ee2-7bad-4ec7-aa04-519131f4de3f
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: ""
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 7f7de683-7b1f-4046-bd50-ea7fdb583f49
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: NUMBER(36,2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Invoice Amount
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b7bb00d-8441-4567-bcd9-6aa73adb48dd
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: MAX("DM01_COMBINED"."DM01_AMOUNT")
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 1a915a3e-ea57-44c5-8bff-6180a5530445
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: NUMBER(36,2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Invoice Amount1
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3b7bb00d-8441-4567-bcd9-6aa73adb48dd
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: MIN("DM01_COMBINED"."DM01_AMOUNT")
        systemColumnType: None
        transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: f7865cb4-29e8-4a96-bbb6-e3a64e0de5d7
          stepCounter: 767ed12f-6933-4936-9ded-404fd1e341c4
        config: {}
        dataType: VARCHAR
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: Source
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ceee4ba-fa87-4c5e-a8c0-fbad648ced91
                stepCounter: 8e473efe-2de8-4255-bf7b-195f76a0318b
            transform: ""
        systemColumnType: None
        transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          CM03_COMBINED: 2cc42f8b-439d-4d56-8885-e426b4ffc34c
          CM04_COMBINED: f47180be-fdce-4312-84ff-04027f8092c0
          CM19_COMBINED: eff228bf-ae85-4729-b262-adc8e690ab35
          DM01_COMBINED: 8e473efe-2de8-4255-bf7b-195f76a0318b
          STG_CM05_COMBINED_MUNI_BILLING: 5a5e9610-ebc0-47e5-9c3b-15332ff9a39f
          STG_CM05_COMBINED_MUNI_ROUTING: 9ddbbe16-6d4b-44e2-a5dc-3093ed0200f9
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TRUXCOMBINED_RAW
            nodeName: CM03_COMBINED
          - locationName: TRUXCOMBINED_RAW
            nodeName: CM04_COMBINED
          - locationName: TRUXCOMBINED_RAW
            nodeName: CM19_COMBINED
          - locationName: TRUXCOMBINED_RAW
            nodeName: DM01_COMBINED
          - locationName: TRUXCOMBINED_RAW
            nodeName: STG_CM05_COMBINED_MUNI_BILLING
          - locationName: TRUXCOMBINED_RAW
            nodeName: STG_CM05_COMBINED_MUNI_ROUTING
        join:
          joinCondition: |-
            FROM {{ ref('TRUXCOMBINED_RAW', 'CM03_COMBINED') }} "CM03_COMBINED"
            INNER JOIN {{ ref('TRUXCOMBINED_RAW', 'CM04_COMBINED') }} "CM04_COMBINED"
            ON "CM03_COMBINED"."CM03_CUST" = "CM04_COMBINED"."CM04_CUST"
            AND "CM03_COMBINED"."SOURCE" = "CM04_COMBINED"."SOURCE"

            INNER JOIN {{ ref('TRUXCOMBINED_RAW', 'STG_CM05_COMBINED_MUNI_ROUTING') }} "STG_CM05_COMBINED_MUNI_ROUTING"
            ON "CM04_COMBINED"."CM04_CUST" = "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_CUST"
            AND "CM04_COMBINED"."CM04_SITE" = "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_SITE"
            AND "CM04_COMBINED"."SOURCE" = "STG_CM05_COMBINED_MUNI_ROUTING"."SOURCE"

            INNER JOIN {{ ref('TRUXCOMBINED_RAW', 'STG_CM05_COMBINED_MUNI_BILLING') }} "STG_CM05_COMBINED_MUNI_BILLING"
            ON "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_FLD7" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_CUST"
            AND "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_FLD8" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_SITE"
            AND "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_FLD9" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_SERV"
            AND "STG_CM05_COMBINED_MUNI_ROUTING"."SOURCE" = "STG_CM05_COMBINED_MUNI_BILLING"."SOURCE"

            INNER JOIN {{ ref('TRUXCOMBINED_RAW', 'CM19_COMBINED') }} "CM19_COMBINED"
            ON "CM19_COMBINED"."CM19_CUST" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_CUST"
            AND "CM19_COMBINED"."CM19_SITE" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_SITE"
            AND "CM19_COMBINED"."CM19_SERV" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_SERV"
            AND "CM19_COMBINED"."SOURCE" = "STG_CM05_COMBINED_MUNI_BILLING"."SOURCE"

            INNER JOIN {{ ref('TRUXCOMBINED_RAW', 'DM01_COMBINED') }} "DM01_COMBINED"
            ON "DM01_COMBINED"."DM01_CUST" = "STG_CM05_COMBINED_MUNI_BILLING"."CM05_CUST"
            AND "DM01_COMBINED"."DM01_DATE" BETWEEN "CM19_COMBINED"."CM19_EFFD" AND "CM19_COMBINED"."CM19_BILL"
            AND "DM01_COMBINED"."SOURCE" = "STG_CM05_COMBINED_MUNI_BILLING"."SOURCE"

             WHERE "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_EDTE" IS NULL
               AND "DM01_COMBINED"."Sort" = 1
               AND "DM01_COMBINED"._fivetran_deleted = FALSE

             GROUP BY "STG_CM05_COMBINED_MUNI_ROUTING"."CM05_CUST"
            	 , "STG_CM05_COMBINED_MUNI_BILLING"."CM05_CUST"
                 , "STG_CM05_COMBINED_MUNI_BILLING"."CM05_CYCL"
            	 , "CM19_COMBINED"."CM19_EFFD"
            	 , "CM19_COMBINED"."CM19_BILL"
            	 , "DM01_COMBINED"."DM01_CUST"
            	 , "DM01_COMBINED"."DM01_INVC"
            	 , "DM01_COMBINED"."DM01_DATE"
                 , "DM01_COMBINED"."SOURCE"
        name: STG_MUNI_REVENUE
        noLinkRefs: []
  name: STG_MUNI_REVENUE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
